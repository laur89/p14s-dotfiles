#!/usr/bin/env bash


# execute command in the background with no completion status to our parent shell.
#
# from https://stackoverflow.com/a/51061046/1803648
# e.g. silent_background sleep 3
silent_background() {
    { 2>&3 "$@"& } 3>&2 2>/dev/null
    disown &>/dev/null  # Prevent whine if job has already completed
}

restart_copyq() {
    killall copyq && sleep 0.5  # important to sleep; otherwise immediately re-starting copyq it states server's already running.
    silent_background  copyq
}

if pgrep i3 >/dev/null; then
    sleep 0.5
    i3-msg restart >/dev/null
fi

#sleep 1
# work around https://github.com/hluk/CopyQ/issues/1595
# note: best not do this as-is, as copyq is now likely running as a systemd service.
#if pgrep copyq >/dev/null; then
    #restart_copyq
#fi

exit 0
